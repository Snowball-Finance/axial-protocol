const { ethers } = require("hardhat");
require("@nomiclabs/hardhat-waffle");
require('dotenv').config();

async function main() {
  const swapDeployer_ABI = [{"inputs": [],"stateMutability": "nonpayable","type": "constructor"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "target","type": "address"},{"indexed": false,"internalType": "address","name": "cloneAddress","type": "address"}],"name": "NewClone","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "deployer","type": "address"},{"indexed": false,"internalType": "address","name": "swapAddress","type": "address"},{"indexed": false,"internalType": "contract IERC20[]","name": "pooledTokens","type": "address[]"}],"name": "NewSwapPool","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "previousOwner","type": "address"},{"indexed": true,"internalType": "address","name": "newOwner","type": "address"}],"name": "OwnershipTransferred","type": "event"},{"inputs": [{"internalType": "address","name": "target","type": "address"}],"name": "clone","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "swapAddress","type": "address"},{"internalType": "contract IERC20[]","name": "_pooledTokens","type": "address[]"},{"internalType": "uint8[]","name": "decimals","type": "uint8[]"},{"internalType": "string","name": "lpTokenName","type": "string"},{"internalType": "string","name": "lpTokenSymbol","type": "string"},{"internalType": "uint256","name": "_a","type": "uint256"},{"internalType": "uint256","name": "_fee","type": "uint256"},{"internalType": "uint256","name": "_adminFee","type": "uint256"},{"internalType": "address","name": "lpTokenTargetAddress","type": "address"}],"name": "deploy","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "metaSwapAddress","type": "address"},{"internalType": "contract IERC20[]","name": "_pooledTokens","type": "address[]"},{"internalType": "uint8[]","name": "decimals","type": "uint8[]"},{"internalType": "string","name": "lpTokenName","type": "string"},{"internalType": "string","name": "lpTokenSymbol","type": "string"},{"internalType": "uint256","name": "_a","type": "uint256"},{"internalType": "uint256","name": "_fee","type": "uint256"},{"internalType": "uint256","name": "_adminFee","type": "uint256"},{"internalType": "address","name": "lpTokenTargetAddress","type": "address"},{"internalType": "contract ISwap","name": "baseSwap","type": "address"}],"name": "deployMetaSwap","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "owner","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "renounceOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "address","name": "newOwner","type": "address"}],"name": "transferOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"}];
  const masterChefV3_ABI = [{"inputs": [{"internalType": "contract IMasterChef","name": "_MASTER_CHEF_V2","type": "address"},{"internalType": "contract IERC20","name": "_axial","type": "address"},{"internalType": "uint256","name": "_MASTER_PID","type": "uint256"}],"stateMutability": "nonpayable","type": "constructor"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "allocPoint","type": "uint256"},{"indexed": true,"internalType": "contract IERC20","name": "lpToken","type": "address"},{"indexed": true,"internalType": "contract IRewarder","name": "rewarder","type": "address"}],"name": "Add","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "user","type": "address"},{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "amount","type": "uint256"}],"name": "Deposit","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "user","type": "address"},{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "amount","type": "uint256"}],"name": "EmergencyWithdraw","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "user","type": "address"},{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "amount","type": "uint256"}],"name": "Harvest","type": "event"},{"anonymous": false,"inputs": [],"name": "Init","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "previousOwner","type": "address"},{"indexed": true,"internalType": "address","name": "newOwner","type": "address"}],"name": "OwnershipTransferred","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "allocPoint","type": "uint256"},{"indexed": true,"internalType": "contract IRewarder","name": "rewarder","type": "address"},{"indexed": false,"internalType": "bool","name": "overwrite","type": "bool"}],"name": "Set","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "lastRewardTimestamp","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "lpSupply","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "accAxialPerShare","type": "uint256"}],"name": "UpdatePool","type": "event"},{"anonymous": false,"inputs": [{"indexed": true,"internalType": "address","name": "user","type": "address"},{"indexed": true,"internalType": "uint256","name": "pid","type": "uint256"},{"indexed": false,"internalType": "uint256","name": "amount","type": "uint256"}],"name": "Withdraw","type": "event"},{"inputs": [],"name": "AXIAL","outputs": [{"internalType": "contract IERC20","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "MASTER_CHEF_V2","outputs": [{"internalType": "contract IMasterChef","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "MASTER_PID","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "allocPoint","type": "uint256"},{"internalType": "contract IERC20","name": "_lpToken","type": "address"},{"internalType": "contract IRewarder","name": "_rewarder","type": "address"}],"name": "add","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "axialPerSec","outputs": [{"internalType": "uint256","name": "amount","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "pid","type": "uint256"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "deposit","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "pid","type": "uint256"}],"name": "emergencyWithdraw","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "harvestFromMasterChef","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "contract IERC20","name": "dummyToken","type": "address"}],"name": "init","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256[]","name": "pids","type": "uint256[]"}],"name": "massUpdatePools","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "owner","outputs": [{"internalType": "address","name": "","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "_pid","type": "uint256"},{"internalType": "address","name": "_user","type": "address"}],"name": "pendingTokens","outputs": [{"internalType": "uint256","name": "pendingAxial","type": "uint256"},{"internalType": "address","name": "bonusTokenAddress","type": "address"},{"internalType": "string","name": "bonusTokenSymbol","type": "string"},{"internalType": "uint256","name": "pendingBonusToken","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "","type": "uint256"}],"name": "poolInfo","outputs": [{"internalType": "contract IERC20","name": "lpToken","type": "address"},{"internalType": "uint256","name": "accAxialPerShare","type": "uint256"},{"internalType": "uint256","name": "lastRewardTimestamp","type": "uint256"},{"internalType": "uint256","name": "allocPoint","type": "uint256"},{"internalType": "contract IRewarder","name": "rewarder","type": "address"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "poolLength","outputs": [{"internalType": "uint256","name": "pools","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [],"name": "renounceOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "_pid","type": "uint256"},{"internalType": "uint256","name": "_allocPoint","type": "uint256"},{"internalType": "contract IRewarder","name": "_rewarder","type": "address"},{"internalType": "bool","name": "overwrite","type": "bool"}],"name": "set","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [],"name": "totalAllocPoint","outputs": [{"internalType": "uint256","name": "","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "address","name": "newOwner","type": "address"}],"name": "transferOwnership","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "pid","type": "uint256"}],"name": "updatePool","outputs": [],"stateMutability": "nonpayable","type": "function"},{"inputs": [{"internalType": "uint256","name": "","type": "uint256"},{"internalType": "address","name": "","type": "address"}],"name": "userInfo","outputs": [{"internalType": "uint256","name": "amount","type": "uint256"},{"internalType": "uint256","name": "rewardDebt","type": "uint256"}],"stateMutability": "view","type": "function"},{"inputs": [{"internalType": "uint256","name": "pid","type": "uint256"},{"internalType": "uint256","name": "amount","type": "uint256"}],"name": "withdraw","outputs": [],"stateMutability": "nonpayable","type": "function"}];
  const [signer] = await ethers.getSigners();
  console.log("Deploying new pool with the account:", signer.address);

  const swapDeployer_addr = "0xbc37E5Ba5abBa3bB67bB76651E04B7c93477636d";
  const masterChefV3_addr = "0x958C0d0baA8F220846d3966742D4Fb5edc5493D3";

  const MIM = "0x130966628846BFd36ff31a822705796e8cb8C18D";
  const AVAI = "0x346a59146b9b4a77100d369a3d18e8007a9f46a6";
  const USDCe = "0xA7D7079b0FEaD91F3e65f86E8915Cb59c1a4C664";

  // address swapAddress,
  // IERC20[] memory _pooledTokens,
  // uint8[] memory decimals,
  // string memory lpTokenName,
  // string memory lpTokenSymbol,
  // uint256 _a,
  // uint256 _fee,
  // uint256 _adminFee,
  // address lpTokenTargetAddress
  const swapAddress = "0xA4A8DAe6A4940EA625769e0d7Fe2991CCa4EA7E9";
  const _pooledTokens = [AVAI, MIM, USDCe];
  const decimals = ["18","18", "6"];
  const lpTokenName = "Axial AVAI+MIM+USDC.e";
  const lpTokenSymbol = "AA3D";
  const _a = 60; // amplification factor
  const _fee = 4000000;
  const _adminFee = 2500000000;
  const lpTokenTargetAddress = "0x834Ac088077db3FbA31FDe3829c77A46d038EfC9";


  const SwapDeployer = new ethers.Contract(swapDeployer_addr, swapDeployer_ABI, signer);
  const deploy = await SwapDeployer.deploy(swapAddress, _pooledTokens, decimals, lpTokenName, lpTokenSymbol, _a, _fee, _adminFee, lpTokenTargetAddress);
  const tx_deploy = await deploy.wait(1);
  if (!tx_deploy.status) {
    console.error(`Error deploying ${lpTokenSymbol}`);
    return;
  }
  console.log(`Deployed ${lpTokenSymbol}`);
  // console.log(`Deployed ${lpTokenSymbol} at`,deploy);
  // const MasterChefV3 = new ethers.Contract(masterChefV3_addr, masterChefV3_ABI, signer);
  // const poolInfo = await MasterChefV3.poolInfo("4");
  // console.log(`Deployed ${lpTokenSymbol} at`,poolInfo.lpToken);

  return;
}

main()
  .then(() => process.exit(0))
  .catch((error) => {
    console.error(error);
    process.exit(1);
  });